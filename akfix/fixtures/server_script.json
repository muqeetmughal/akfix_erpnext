[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-08-11 21:11:03.372193",
  "module": "AKFix",
  "name": "Internal Action Trigger",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Order",
  "script": "import frappe\n\nif doc.docstatus == 1:\n    subject = f\"Follow-up Needed: Sales Order {doc.name}\"\n    message = f\"\"\"\n    Hi Team,\n\n    A new Sales Order has been submitted that requires internal follow-up.\n\n    Sales Order: {doc.name}\n    Customer: {doc.customer}\n    Total Amount: {doc.grand_total}\n    Due Date: {doc.delivery_date or 'N/A'}\n\n    Please take appropriate action and ensure timely processing.\n\n    Thanks,\n    ERP System\n    \"\"\"\n\n    # List of internal sales team emails â€“ adjust as needed\n    internal_emails = [\"zain.geelhr@gmail.com\"]\n\n    frappe.sendmail(\n        recipients=internal_emails,\n        subject=subject,\n        message=message,\n        reference_doctype=\"Sales Order\",\n        reference_name=doc.name,\n        now=True\n    )\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-08-11 21:12:16.814340",
  "module": "AKFix",
  "name": "Overdue Reminder",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Invoice",
  "script": "import frappe\nfrom frappe.utils import today\n\ndef send_overdue_invoice_reminders():\n    # Fetch all submitted Sales Invoices that are unpaid and past due\n    overdue_invoices = frappe.get_all(\n        \"Sales Invoice\",\n        filters={\n            \"docstatus\": 1,\n            \"status\": \"Unpaid\",\n            \"due_date\": [\"<\", today()]\n        },\n        fields=[\"name\", \"customer\", \"customer_email\", \"due_date\", \"grand_total\"]\n    )\n\n    for inv in overdue_invoices:\n        subject = f\"Payment Reminder: Invoice {inv.name} is Overdue\"\n        message = f\"\"\"\n        Dear {inv.customer},\n\n        Invoice Number: {inv.name}\n        Due Date: {inv.due_date}\n        Total Due: {inv.grand_total}\n\n        This is a friendly reminder that this invoice is now overdue. Please make payment at your earliest convenience.\n\n        Thank you,\n        Your Company Name\n        \"\"\"\n\n        # Use frappe.sendmail to send reminder\n        frappe.sendmail(\n            recipients=[inv.customer_email],\n            subject=subject,\n            message=message,\n            reference_doctype=\"Sales Invoice\",\n            reference_name=inv.name,\n            now=True\n        )\n\n# Call the function to run it\nsend_overdue_invoice_reminders()\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-08-11 21:15:23.051139",
  "module": "AKFix",
  "name": "Order Confirmation",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Order",
  "script": "if doc.docstatus == 1:\n    # Compose your message\n    subject = f\"Sales Order {doc.name} Submitted\"\n    message = f\"\"\"\n    Hi {doc.customer},\n\n    Your Sales Order {doc.name} has been successfully submitted.\n    Total Amount: {doc.grand_total}\n\n    Thank you,\n    Your Company\n    \"\"\"\n\n    # Send the email\n    frappe.sendmail(\n        recipients=[doc.contact_email or doc.customer_email or doc.customer],\n        subject=subject,\n        message=message,\n        reference_doctype=doc.doctype,\n        reference_name=doc.name,\n    )",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-08-15 15:20:32.334939",
  "module": "AKFix",
  "name": "Approval Required Mail",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Order",
  "script": "import frappe\n\nif doc.docstatus == 0:  # Not submitted yet\n    discount_pct = doc.additional_discount_percentage or 0\n    if discount_pct > 10 or doc.grand_total > 30000:\n        subject = f\"Approval Needed: Sales Order {doc.name}\"\n        message = f\"\"\"\n        Dear Administrator,\n\n        A Sales Order requires your approval.\n\n        Customer: {doc.customer}\n        Discount: {discount_pct}%\n        Amount: {doc.grand_total}\n\n        Please log in to approve or reject it.\n        \"\"\"\n        frappe.sendmail(\n            recipients=[\"admin@company.com\"],  # Change to actual admin email\n            subject=subject,\n            message=message,\n            reference_doctype=\"Sales Order\",\n            reference_name=doc.name,\n            now=True\n        )\n",
  "script_type": "DocType Event"
 }
]